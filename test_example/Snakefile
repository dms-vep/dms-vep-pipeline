"""Top-level ``snakemake`` file that runs analysis."""


import os


configfile: "config.yaml"


# include `dms-vep-pipeline` pipeline Snakemake file
include: os.path.join(config["pipeline_path"], "pipeline.smk")


rule all:
    input:
        variant_count_files,
        rules.check_adequate_variant_counts.output.passed,
        # antibody escape output
        expand(
            rules.fit_polyclonal.output.pickle,
            antibody_selection_group=antibody_selections["selection_group"].unique(),
        ),
        # functional effects of mutations output
        expand(
            rules.fit_globalepistasis.output.muteffects_latent,
            func_selection=func_selections["selection_name"],
        ),
        expand(
            rules.fit_globalepistasis.output.muteffects_observed,
            func_selection=func_selections["selection_name"],
        ),
        (
            [config["muteffects_observed"], config["muteffects_latent"]]
            if len(func_selections)
            else []
        ),
        # HTML documentation output
        config["docs"],


# Arbitrary other rules should be added here

# Add any extra data/results files for docs with name: file
extra_data_files = {}


# include `dms-vep-pipeline` docs building Snakemake file
include: os.path.join(config["pipeline_path"], "docs.smk")
